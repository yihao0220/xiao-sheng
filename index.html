<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大学任务提醒</title>
    <link rel="stylesheet" href="./styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#f5f5f7">
</head>
<body>
    <div id="debug-info" style="background-color: yellow; padding: 10px; margin-bottom: 10px;">
        <p>调试信息将显示在这里</p>
    </div>
    <div class="container">
        <header class="header">
            <h1>大学任务提醒</h1>
            <div class="auth-buttons">
                <button id="loginButton" class="button primary-button">登录</button>
                <button id="logoutButton" class="button secondary-button" style="display: none;">退出登录</button>
            </div>
        </header>

        <main class="content">
            <div id="authForm" style="display: none;">
                <form id="loginForm" class="fade-in">
                    <h2>登录</h2>
                    <label for="loginUsername">用户名:</label>
                    <input type="text" id="loginUsername" required><br>
                    <label for="loginPassword">密码:</label>
                    <input type="password" id="loginPassword" required><br>
                    <button id="submitLoginButton" class="button">提交</button>
                </form>
                <a href="#" id="showRegisterLink">没有账号？注册新账户</a>
            </div>

            <div id="taskManager" style="display: none;">
                <button id="showAddTaskFormButton" class="button primary-button">设置任务</button>
                
                <div id="addTaskForm" class="task-form" style="display: none;">
                    <h2>添加新任务</h2>
                    <input type="text" id="taskName" placeholder="任务名称">
                    <input type="date" id="startDate">
                    <input type="time" id="startTime">
                    <input type="date" id="endDate">
                    <input type="time" id="endTime">
                    <select id="priority">
                        <option value="low">低优先级</option>
                        <option value="medium">中优先级</option>
                        <option value="high">高优先级</option>
                    </select>
                    <input type="text" id="category" placeholder="分类 (可选)">
                    <input type="text" id="location" placeholder="地点 (可选)">
                    <button id="addTaskButton" class="button">添加任务</button>
                    <button id="cancelAddTaskButton" class="button">取消</button>
                </div>

                <section class="task-list-section fade-in">
                    <h2>任务列表</h2>
                    <div class="task-controls">
                        <label for="sortBy">排序方式:</label>
                        <select id="sortBy">
                            <option value="startDate">开始日期</option>
                            <option value="endDate">结束日期</option>
                            <option value="priority">优先级</option>
                        </select>
                        <input type="text" id="searchInput" placeholder="搜索任务...">
                        <button id="clearSearchButton" class="button">清除搜索</button>
                    </div>
                    <ul id="allTasks" class="task-list"></ul>
                </section>

                <section class="class-info-section fade-in">
                    <h2>添加课程信息</h2>
                    <form id="classForm" class="task-form">
                        <input type="text" id="className" placeholder="课程名称">
                        <select id="classDay">
                            <option value="周一">周一</option>
                            <option value="周二">周二</option>
                            <option value="周三">周三</option>
                            <option value="周四">周四</option>
                            <option value="周五">周五</option>
                            <option value="周六">周六</option>
                            <option value="周日">周日</option>
                        </select>
                        <input type="time" id="classTime">
                        <input type="text" id="classLocation" placeholder="上课地点 (可选)">
                        <button id="addClassButton" class="button">添加课程</button>
                    </form>
                </section>

                <button id="logoutButton" class="button secondary-button" style="display: none;">退出登录</button>
            </div>
        </main>
    </div>

    <div id="notificationContainer"></div>

    <script src="./script.js"></script>
    <!-- 在 </body> 标签之前添加以下代码 -->
    <script>
        console.log("页面加载完成");
    </script>

    <script>
        function updateDebugInfo() {
            var debugInfo = document.getElementById('debug-info');
            debugInfo.innerHTML = `
                <p>窗口尺寸: ${window.innerWidth} x ${window.innerHeight}</p>
                <p>是否登录: ${localStorage.getItem("isLoggedIn") === "true" ? "是" : "否"}</p>
                <p>authForm 显示: ${window.getComputedStyle(document.getElementById('authForm')).display}</p>
                <p>taskManager 显示: ${window.getComputedStyle(document.getElementById('taskManager')).display}</p>
            `;
        }
        window.addEventListener('load', updateDebugInfo);
        window.addEventListener('resize', updateDebugInfo);
    </script>
</body>
</html>
// 在文件开头添加以下代码
window.onerror = function(message, source, lineno, colno, error) {
    console.error("发生错误:", message, "在", source, "行号:", lineno);
    alert("抱歉，发生了一个错误。请查看控制台以获取更多信息。");
};

console.log("Script started"); // 添加这行

document.addEventListener("DOMContentLoaded", function() {
    console.log("DOMContentLoaded event fired");
    try {
        const authForm = document.getElementById("authForm");
        const taskManager = document.getElementById("taskManager");
        const loginUsername = document.getElementById("loginUsername");
        const loginPassword = document.getElementById("loginPassword");
        const loginButton = document.getElementById("loginButton");
        const submitLoginButton = document.getElementById("submitLoginButton");
        const logoutButton = document.getElementById("logoutButton");
        const addTaskButton = document.getElementById("addTaskButton");
        const taskName = document.getElementById("taskName");
        const allTasks = document.getElementById("allTasks");
        const showAddTaskFormButton = document.getElementById("showAddTaskFormButton");
        const addTaskForm = document.getElementById("addTaskForm");
        const cancelAddTaskButton = document.getElementById("cancelAddTaskButton");

        // 加载任务
        function loadTasks() {
            console.log("loadTasks called");
            const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
            allTasks.innerHTML = "";
            tasks.forEach((task, index) => {
                const li = document.createElement("li");
                li.className = "task-item slide-in";
                li.innerHTML = `
                    <span>${task.name}</span>
                    <button class="delete-button" data-index="${index}">删除</button>
                `;
                allTasks.appendChild(li);
            });
        }

        // 添加任务
        addTaskButton.addEventListener("click", function(event) {
            event.preventDefault();
            if (taskName.value) {
                showLoading(this);
                setTimeout(() => {
                    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                    tasks.push({ 
                        name: taskName.value, 
                        completed: false,
                    });
                    localStorage.setItem("tasks", JSON.stringify(tasks));
                    taskName.value = "";
                    loadTasks();
                    addTaskForm.style.display = "none";
                    showAddTaskFormButton.style.display = "block";
                    hideLoading(this);
                }, 500); // 模拟加载时间
            }
        });

        // 删除任务
        allTasks.addEventListener("click", function(event) {
            if (event.target.classList.contains("delete-button")) {
                const index = event.target.dataset.index;
                const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                tasks.splice(index, 1);
                localStorage.setItem("tasks", JSON.stringify(tasks));
                loadTasks();
            }
        });

        // 显示未完成任务
        function showUnfinishedTasks() {
            const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
            const unfinishedTasks = tasks.filter(task => !task.completed);

            if (unfinishedTasks.length > 0) {
                let message = "您有以下未完成的任务:\n";
                unfinishedTasks.forEach(task => {
                    message += `- ${task.name}\n`;
                });
                alert(message);
            }
        }

        // 检查本地存储中是否有登录信息
        function checkLoginStatus() {
            console.log("checkLoginStatus called");
            const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
            console.log("isLoggedIn:", isLoggedIn);

            if (isLoggedIn) {
                console.log("User is logged in, showing task manager");
                authForm.style.display = "none";
                taskManager.style.display = "block";
                loginButton.style.display = "none";
                logoutButton.style.display = "inline-block";
            } else {
                console.log("User is not logged in, showing auth form");
                authForm.style.display = "block";
                taskManager.style.display = "none";
                loginButton.style.display = "inline-block";
                logoutButton.style.display = "none";
            }

            document.querySelector('.container').style.display = 'block';
            console.log("authForm display:", authForm.style.display);
            console.log("taskManager display:", taskManager.style.display);
            console.log("Login status checked");
        }

        // 登录按钮事件
        loginButton.addEventListener("click", function() {
            authForm.style.display = "block";
            loginButton.style.display = "none";
        });

        // 提交登录表单事件
        submitLoginButton.addEventListener("click", function(event) {
            event.preventDefault();
            if (loginUsername.value && loginPassword.value) {
                localStorage.setItem("isLoggedIn", "true");
                checkLoginStatus();
            }
        });

        // 退出登录按钮事件
        logoutButton.addEventListener("click", function() {
            localStorage.removeItem("isLoggedIn");
            checkLoginStatus();
        });

        // 显示添加任务表单
        showAddTaskFormButton.addEventListener("click", function() {
            addTaskForm.style.display = "block";
            addTaskForm.classList.add("fade-in");
            showAddTaskFormButton.style.display = "none";
        });

        // 取消添加任务
        cancelAddTaskButton.addEventListener("click", function() {
            addTaskForm.style.display = "none";
            showAddTaskFormButton.style.display = "block";
            // 清空表单
            document.getElementById("taskName").value = "";
            document.getElementById("startDate").value = "";
            document.getElementById("startTime").value = "";
            document.getElementById("endDate").value = "";
            document.getElementById("endTime").value = "";
            document.getElementById("priority").value = "low";
            document.getElementById("category").value = "";
            document.getElementById("location").value = "";
        });

        // 初始化
        checkLoginStatus();
        loadTasks();

        // 添加加载动画函数
        function showLoading(element) {
            const loadingSpinner = document.createElement("div");
            loadingSpinner.className = "loading";
            element.appendChild(loadingSpinner);
        }

        function hideLoading(element) {
            const loadingSpinner = element.querySelector(".loading");
            if (loadingSpinner) {
                loadingSpinner.remove();
            }
        }

        console.log("Script initialization completed"); // 添加这行
    } catch (error) {
        console.error("初始化过程中发生错误:", error);
        alert("初始化过程中发生错误。请查看控制台以获取更多信息。");
    }
}); // 确保这里有一个闭合的圆括号和分号

console.log("Script end"); // 添加这行
